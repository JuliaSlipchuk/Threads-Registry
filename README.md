# Threads-Registry

Windows-служба “Task_Queue”, яка приймає від користувача заявки на виконання задач і послідовно їх виконує у фоновому процесі з врахування пріорітету задач. Час виконання однієї задачі - Х секунд. X встановлюється в параметрі реєстру. 
HKLM/Software/Task_Queue/Parameters/Task_Execution_Duration
лежить в діапазоні від 30 до 180 секунд, дифолтне значення 60 секунд.
Всі свої повідомлення служба записує в журнал
C:\Windows\Logs\TaskQueue_18-11-2013.log

При успішному розміщенні заявки служба дописує в журнал новий запис

-----------------------------------------<Дата/час>----------------------------------------------------------------
Задача Task_0832 успішно прийнята в обробку...

При розміщенні заявки з некоректним синтаксисом (що не відповідає регулярному виразу) служба дописує в журнал такий запис:

-----------------------------------------<Дата/час>----------------------------------------------------------------
ПОМИЛКА розміщення заявки Tassskkk_0832. Некоректний синтаксис ...

Ознака правильного синтаксису заявки - це слово “Task”, після нього символ «_» і 4 цифри. Після додавання запису в журнал некоректна заявка вилучається.

Для того, щоб розмістити заявку - потрібно створити в каталозі
C:\Windows\Task_Queue\Claims
новий текстовий файл з ім’ям Task_XXХХ.txt і порожнім змістом, де XХХX - новий унікальний номер задачі. Якщо заявка має правильний синтаксис, але номер вже існує, в журнал повинен бути доданий запис про помилку:

-----------------------------------------<Дата/час>----------------------------------------------------------------
ПОМИЛКА розміщення заявки Task_0832. Номер вже існує ...

Якщо заявка успішно приймається в обробку - це означає, що створений користувачем текстовий файл в каталозі C:\Windows\Task_Queue\Claims вилучається і замість нього створюється новий текстовий файл з ім’ям Task_0832-[………………..]-Queued.txt і порожнім змістом в каталозі
C:\Windows\Task_Queue\Tasks . Квадратні скобки означають прогрес-бар, між ними - 20 точок, кожна з яких означає 5 відсотків виконаної задачі. 

Якщо заявка за відомих причин не приймається - залишається відповідне повідомлення в журналі і вилучається текстовий файл в каталозі C:\Windows\Task_Queue\Claims .
	Служба повинна бути реалізована у вигляді двох паралельно працюючих процесів (threads). Перший процес тільки слідкує за каталогом C:\Windows\Task_Queue\Claims і як тільки в ньому з’являється одна або більше нових заявок, процес послідовно їх обробляє одну за одною в залежності від  коректності кожної з них. Якщо заявка некоректна, процес лише її вилучає і залишає повідомлення в журналі. Якщо заявка коректна, то процес її також вилучає, залишає повідомлення в журналі і створює нову задачу. Тривалість одного циклу роботи першого процесу - Y секунд. Y встановлюється в параметрі реєстру. 
HKLM/Software/Task_Queue/Parameters/Task_Claim_Check_Period
має діапазон значень від 10 до 45 секунд, дифолтне значення 30 секунд. За один цикл перший процес повинен прийняти тільки одну коректну заявку. Якщо перший процес виявив дві або більше коректні заявки - він приймає тільки одну з них, що має менший номер, а інші залишає на наступний цикл. 
	Другий процес безпосередньо «виконує» задачі, які поставлені в чергу першим процесом. Одночасно другий процес може виконувати максимум Y задач. Y має значення від 1 до 3 (дифолтне значення 1) і встановлюється в параметрі реєстру 
HKLM/Software/Task_Queue/Parameters/Task_Execution_Quantity

Якщо, наприклад, Y=1, то задачі виконуються послідовно, наступна починається тільки після повного виконання попередньої. В результаті список задач виглядає наступним чином: 
  
........	.........	...........................
Task_0731-[IIIIIIIIIIIIIIIIIIII]-COMPLETED.txt
Task_0832-[IIIIIIIIIIIIIIIIIIII]-COMPLETED.txt
Task_0905-[IIIIIIIIIIIIIII.....]-In progress - 77 percents.txt
Task_1002-[....................]-Queued.txt
Task_1137-[....................]-Queued.txt
.........	.........	...........................

Якщо в даний момент «виконується» заявка - в неї повинно бути значення «In progress» і відсоток виконання, який другий процес збільшує до тих пір, поки процес не виконається і не отримає значення “COMPLETED”. Відсоток повинен оновлюватить кожні 2 секунди і повинен бути округленним до цілих відсотків. Якщо задача виконана, наприклад, на 25-29%, то в прогрес-барі перші 5 точок повинні бути замінені на 5 літер «I» (велика латинська буква «i»). Як тільки завершується поточна задача, в журнал додається запис

-----------------------------------------<Дата/час>----------------------------------------------------------------
Задача Task_0832 успішно ВИКОНАНА!

і починається виконання наступної в черзі задачі з найменшим номером. Коли всі задачі в черзі виконані - другий процес нічого не робить, тільки слідкує коли з’явиться нова задача.
